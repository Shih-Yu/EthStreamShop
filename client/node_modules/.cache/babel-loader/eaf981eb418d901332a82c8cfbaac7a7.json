{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.withTimeout = void 0;\n\nvar tslib_1 = require(\"tslib\"); // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\n\nfunction withTimeout(sync, timeout, timeoutError) {\n  var _this = this;\n\n  if (timeoutError === void 0) {\n    timeoutError = new Error('timeout');\n  }\n\n  return {\n    acquire: function () {\n      return new Promise(function (resolve, reject) {\n        return tslib_1.__awaiter(_this, void 0, void 0, function () {\n          var isTimeout, ticket, release;\n          return tslib_1.__generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                isTimeout = false;\n                setTimeout(function () {\n                  isTimeout = true;\n                  reject(timeoutError);\n                }, timeout);\n                return [4\n                /*yield*/\n                , sync.acquire()];\n\n              case 1:\n                ticket = _a.sent();\n\n                if (isTimeout) {\n                  release = Array.isArray(ticket) ? ticket[1] : ticket;\n                  release();\n                } else {\n                  resolve(ticket);\n                }\n\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      });\n    },\n    runExclusive: function (callback) {\n      return tslib_1.__awaiter(this, void 0, void 0, function () {\n        var release, ticket;\n        return tslib_1.__generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              release = function () {\n                return undefined;\n              };\n\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1,, 7, 8]);\n\n              return [4\n              /*yield*/\n              , this.acquire()];\n\n            case 2:\n              ticket = _a.sent();\n              if (!Array.isArray(ticket)) return [3\n              /*break*/\n              , 4];\n              release = ticket[1];\n              return [4\n              /*yield*/\n              , callback(ticket[0])];\n\n            case 3:\n              return [2\n              /*return*/\n              , _a.sent()];\n\n            case 4:\n              release = ticket;\n              return [4\n              /*yield*/\n              , callback()];\n\n            case 5:\n              return [2\n              /*return*/\n              , _a.sent()];\n\n            case 6:\n              return [3\n              /*break*/\n              , 8];\n\n            case 7:\n              release();\n              return [7\n              /*endfinally*/\n              ];\n\n            case 8:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    },\n    release: function () {\n      sync.release();\n    },\n    isLocked: function () {\n      return sync.isLocked();\n    }\n  };\n}\n\nexports.withTimeout = withTimeout;","map":{"version":3,"sources":["/Users/shih-yuhwang/Portfolio/EthStreamShop/client/node_modules/async-mutex/lib/withTimeout.js"],"names":["Object","defineProperty","exports","value","withTimeout","tslib_1","require","sync","timeout","timeoutError","_this","Error","acquire","Promise","resolve","reject","__awaiter","isTimeout","ticket","release","__generator","_a","label","setTimeout","sent","Array","isArray","runExclusive","callback","undefined","trys","push","isLocked"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.withTimeout = void 0;\nvar tslib_1 = require(\"tslib\");\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nfunction withTimeout(sync, timeout, timeoutError) {\n    var _this = this;\n    if (timeoutError === void 0) { timeoutError = new Error('timeout'); }\n    return {\n        acquire: function () {\n            return new Promise(function (resolve, reject) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var isTimeout, ticket, release;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            isTimeout = false;\n                            setTimeout(function () {\n                                isTimeout = true;\n                                reject(timeoutError);\n                            }, timeout);\n                            return [4 /*yield*/, sync.acquire()];\n                        case 1:\n                            ticket = _a.sent();\n                            if (isTimeout) {\n                                release = Array.isArray(ticket) ? ticket[1] : ticket;\n                                release();\n                            }\n                            else {\n                                resolve(ticket);\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n        },\n        runExclusive: function (callback) {\n            return tslib_1.__awaiter(this, void 0, void 0, function () {\n                var release, ticket;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            release = function () { return undefined; };\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, , 7, 8]);\n                            return [4 /*yield*/, this.acquire()];\n                        case 2:\n                            ticket = _a.sent();\n                            if (!Array.isArray(ticket)) return [3 /*break*/, 4];\n                            release = ticket[1];\n                            return [4 /*yield*/, callback(ticket[0])];\n                        case 3: return [2 /*return*/, _a.sent()];\n                        case 4:\n                            release = ticket;\n                            return [4 /*yield*/, callback()];\n                        case 5: return [2 /*return*/, _a.sent()];\n                        case 6: return [3 /*break*/, 8];\n                        case 7:\n                            release();\n                            return [7 /*endfinally*/];\n                        case 8: return [2 /*return*/];\n                    }\n                });\n            });\n        },\n        release: function () {\n            sync.release();\n        },\n        isLocked: function () { return sync.isLocked(); },\n    };\n}\nexports.withTimeout = withTimeout;\n"]},"metadata":{},"sourceType":"script"}